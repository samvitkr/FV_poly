# README #

This git repository contains MATLAB scripts and routines to transform DNS data of a turbulent channel flow from a finite volume to a spectral representation (Fourier Galerkin in the wall-parallel coordinates x and z, Chebyshev collocation in the wall-normal coordinate y). The repository contains three subfolders:

* data_readers: functions to read the grid and Cartesian velocity fields from binary files generated by the DNS
* examples: example scripts that demonstrate how to use the code in this repository to 1) determine a suitable number of Chebyshev collocation points, and 2) transform the data to spectral space. You can download the DNS output data required to run these scripts [here](https://livejohnshopkins-my.sharepoint.com/:f:/g/personal/stoedtl1_jh_edu/Eq_B4b21yx5Fg6eLi4zuYjsBZJp3re1-LI3k4D_hkL3vRw?e=IvmSOW).
* utilities: classes and functions to preform all necessary operations on the DNS data (derivatives, interpolation, divergence-free projection)

## Prerequisites ##
In order to use these source files, you have to:

* download the [MATLAB Differentiation Matrix Suite](https://www.mathworks.com/matlabcentral/fileexchange/29-dmsuite) and make sure the source folder is added to the MATLAB path. The differentiation matrix suite generates the Chebyshev collocation grid and differentiation matrices.
* make sure you use MATLAB 2019b or newer. The code relies on function argument validation, which is a more recent MATLAB feature.

## How to use this code ##

### Information and data files required from DNS ###

In order to use this code, you need the following information about the DNS parameters:

* number of physical grid points in x, y, z (variables ngx, ngy, ngz in the example scripts)
* z domain size (variable Lz)

and the following binary files produced by the DNS (this assumes you want to process velocity fields only):

* {x, y} grid stored in grid.data
* Cartesian velocities stored in 0{1u,2v,3w}c00.dble.*

For reference, the DNS parameters for the provided example data are:

* ngx = 193
* ngy = 225
* ngz = 161
* Lz = 2Ï€


### Required number of Chebyshev collocation points ###
You further need to determine the number of Chebyshev collocation points N required to adequately represent the finite volume DNS data in the wall-normal direction. A suitable choice of N can be determined as follows:

1. Read in a sample flow field q. The wall-normal velocity v is a good choice, because it has no spatial mean
2. Interpolate the data from the DNS grid onto the N Chebyshev collocation points using spline interpolation: S<sub>N</sub>(v)
3. Interpolate the data from the Chebyshev collocation points back to the DNS grid using the Chebyshev polynomial: P<sub>N</sub>(S<sub>N</sub>(v))
4. Evaluate the reconstruction error E = ||v - P<sub>N</sub>(S<sub>N</sub>(v)) ||
5. Repeat 1-4 for an increasing number of collocation points. Once N is large enough to capture all features of the data, the reconstruction error E will no longer decrease with increasing N. The minimum N for which E plateaus is a suitable choice.

This procedure is demonstrated in the script ./examples/determine_required_collocation_points.m
and an example result is shown in the figure below. For this example, N = 151 is a suitable choice for the number of Chebyshev collocation points. You will have to repeat this process to determine a suitable N for your own data.

![Reconstruction error](./reconstruction_error.png)


### Transform data to spectral space ###
It is easiest to understand the steps for transforming the data to spectral space (Fourier Galerkin in x, z, and Chebyshev collocation in y) by looking at the example script ./examples/transform_vel_fields_to_spectral.m. You can download the sample DNS data required to execute the script from [here](https://livejohnshopkins-my.sharepoint.com/:f:/g/personal/stoedtl1_jh_edu/Eq_B4b21yx5Fg6eLi4zuYjsBZJp3re1-LI3k4D_hkL3vRw?e=IvmSOW).

A few remarks about the spectral operators:

* you likely loose the Nyquist frequency content when interpolating from the staggered grid to the collocated grid. If this is an issue, we can see if there are ways to avoid this information loss.
* keep in mind that applying the first {x, z} derivative operator twice is in general not the same as applying the second derivative operator. This is again because of the Nyquist frequency. If you need second derivatives in x, z, we may need to provide these operators explicitly.


## Contact  ##

Feel free to reach out if anything is unclear or if you have any questions: [s.toedtli@jhu.edu](mailto:s.toedtli@jhu.edu)

